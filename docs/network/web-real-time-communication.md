## 短轮询

浏览器每隔一段时间向浏览器发送 http 请求

### 优点

- 比较简单，易于理解
- 成本低，前后端不需要改造

### 缺点

- 需要不断的建立 http 连接，请求数多，服务端压力大
- 效率低，严重浪费了服务器端和客户端的资源
- 非严格实时，高延迟

不适用于同时在线用户数量比较大，并且很注重性能的 Web 应用

## 长轮询(comet)

当服务器收到客户端发来的请求后，不会直接进行响应，而是先将这个请求挂起，然后判断服务器端数据是否有更新。如果有更新，则进行响应，如果一直没有数据，则到达一定的时间限制(服务器端设置)后关闭连接

### 优点

- 和短轮询相比减少了不必要的请求次数节约资源

### 缺点

- 即使连接挂起也会导致资源的浪费

## 长连接(SSE)

SSE 是 HTML5 新增的功能，全称为 Server-SentEvents。它可以允许服务推送数据到客户端。SSE 在本质上就与之前的长轮询、短轮询不同，虽然都是基于 http 协议的，但是轮询需要客户端先发送请求。而 SSE 最大的特点就是不需要客户端发送请求，可以实现只要服务器端数据有更新，就可以马上发送到客户端

### 优点

- 不需要建立或保持大量的客户端发往服务器端的请求，节约了很多资源
- 实现非常简单，不需要依赖其他插件

## WebSocket

### 优点

- 更强的实时性。基于 TCP 协议的全双工通信
- 更高效。一方面是数据包相对较小，另一方面相比传统 XHR-Streaming 和轮询方式更加高效，不需要重复建立 TCP 连接
- 更好的二进制支持。 Websocket 定义了二进制帧，相对 HTTP，可以更轻松地处理二进制内容
- 保持连接状态。 相比 HTTP 无状态的协议，WebSocket 只需要在建立连接时携带认证信息，后续的通信都在这个会话内进行
- 可以支持扩展。Websocket 定义了扩展，用户可以扩展协议、实现部分自定义的子协议。如部分浏览器支持压缩等

### 缺点

- 服务器端的逻辑非常复杂，有改造成本

## 比较

兼容性：短轮询 > 长轮询 > 长连接 SSE > WebSocket；

效果/性能方面：WebSocket(IE10 以下不支持) > 长连接 SSE > 长轮询 > 短轮询

开发成本方面：WebSocket > 长连接 SSE > 长轮询 > 短轮询

http 无状态; websocket 有状态

短轮询和长轮询都是基于 http 单向通信，只有客户端发起服务端才能回复，实时性不强；都是需要不断建立连接然后断开

websocket 只需要在建立连接时携带认证信息，后续不需要，所以数据包轻量

## keep-alive vs websocket

keep-alive：单向通信，只有客户端发起服务端才能回复；每次请求需要带完整信息，数据包大；无状态
websocket：双向通信；只需要在建立连接时携带认证信息，后续不需要，数据包轻量；有状态
